server:
  port: 8342

spring:
  application:
    name: docst

  profiles:
    active: ${SPRING_PROFILES_ACTIVE:local}

  autoconfigure:
    exclude:
      # Spring AI 1.1.0 - 동적 설정 사용으로 AutoConfiguration 비활성화
      # OpenAI: Chat, Embedding 모두 동적 관리로 비활성화 (크리덴셜 기반)
      - org.springframework.ai.model.openai.autoconfigure.OpenAiChatAutoConfiguration
      - org.springframework.ai.model.openai.autoconfigure.OpenAiEmbeddingAutoConfiguration
      - org.springframework.ai.model.openai.autoconfigure.OpenAiImageAutoConfiguration
      - org.springframework.ai.model.openai.autoconfigure.OpenAiAudioTranscriptionAutoConfiguration
      - org.springframework.ai.model.openai.autoconfigure.OpenAiAudioSpeechAutoConfiguration
      - org.springframework.ai.model.openai.autoconfigure.OpenAiModerationAutoConfiguration
      # Ollama: Chat/Embedding 모두 비활성화 (필요시 동적 생성)
      - org.springframework.ai.model.ollama.autoconfigure.OllamaChatAutoConfiguration
      - org.springframework.ai.model.ollama.autoconfigure.OllamaEmbeddingAutoConfiguration
      # PgVector 벡터스토어 - 동적 관리
      - org.springframework.ai.vectorstore.pgvector.autoconfigure.PgVectorStoreAutoConfiguration
      # Neo4j - 조건부 활성화를 위해 AutoConfiguration 비활성화
      - org.springframework.boot.actuate.autoconfigure.neo4j.Neo4jHealthContributorAutoConfiguration
      - org.springframework.boot.autoconfigure.data.neo4j.Neo4jDataAutoConfiguration
      - org.springframework.boot.autoconfigure.data.neo4j.Neo4jReactiveDataAutoConfiguration
      - org.springframework.boot.autoconfigure.data.neo4j.Neo4jRepositoriesAutoConfiguration
      - org.springframework.boot.autoconfigure.data.neo4j.Neo4jReactiveRepositoriesAutoConfiguration

  datasource:
    url: jdbc:postgresql://${DB_HOST:localhost}:${DB_PORT:5434}/${DB_NAME:docst}
    username: ${DB_USERNAME:postgres}
    password: ${DB_PASSWORD:postgres}
    driver-class-name: org.postgresql.Driver

  jpa:
    hibernate:
      ddl-auto: validate
    open-in-view: false
    properties:
      hibernate:
        dialect: org.hibernate.dialect.PostgreSQLDialect
        format_sql: true

  flyway:
    enabled: true
    locations: classpath:db/migration
    baseline-on-migrate: true

  # Spring AI Configuration
  # NOTE: All AI configs (Chat, Embedding, Vector Store) are managed dynamically per-project
  # using dm_system_config and dm_credential tables (Phase 4-E, Phase 6).
  ai:
    # MCP Server Configuration (Phase 11)
    # Spring AI MCP Server WebMVC - SSE Transport
    mcp:
      server:
        enabled: true
        name: Docst MCP Server
        version: 1.0.0
        type: SYNC
        transport: WEBMVC
        instructions: "Docst documentation hub MCP server providing document management, search, and Git operations"
        # Annotation scanner for @McpTool, @McpResource
        annotation-scanner:
          enabled: true
        # Capabilities
        capabilities:
          tool: true
          resource: false
          prompt: false
          completion: false
        # SSE Transport endpoints
        # Default SSE endpoint: /sse (auto-configured by Spring AI)
        # Message endpoint for client responses
        sse-message-endpoint: /mcp/messages
        keep-alive-interval: 30s
    # OpenAI - All configurations moved to Credential management (dynamic)
    # Chat API Key: stored in dm_credential (CredentialType.OPENAI_API_KEY)
    # Embedding API Key: stored in dm_credential (CredentialType.OPENAI_API_KEY)
    # Provider settings: stored in dm_system_config (llm.provider, embedding.provider)

    # Vector Store (PgVector)
    vectorstore:
      pgvector:
        index-type: HNSW
        distance-type: COSINE_DISTANCE
        dimensions: ${EMBEDDING_DIMENSIONS:1536}
        remove-existing-vector-store-table: false
        initialize-schema: true
        schema-name: public
        table-name: vector_store
        schema-validation: true

docst:
  # Application Base URL (used for API documentation, callbacks, etc.)
  base-url: ${DOCST_BASE_URL:http://localhost:8342}

  git:
    root-path: ${DOCST_GIT_ROOT:/data/git}

  # JWT Configuration
  jwt:
    secret: ${JWT_SECRET:docst-dev-secret-key-change-in-production-must-be-256-bits}
    expiration: 86400  # 24 hours in seconds

  # GitHub OAuth Configuration
  github:
    client-id: ${GITHUB_CLIENT_ID:}
    client-secret: ${GITHUB_CLIENT_SECRET:}
    callback-url: ${GITHUB_CALLBACK_URL:http://localhost:8342/api/auth/github/callback}
    frontend-callback-url: ${GITHUB_FRONTEND_CALLBACK_URL:http://localhost:3000/auth/callback}

  # GitHub Webhook Configuration
  webhook:
    github:
      secret: ${GITHUB_WEBHOOK_SECRET:}

  # LLM Configuration (Phase 6)
  llm:
    enabled: ${LLM_ENABLED:true}

  # Chunking Configuration
  chunking:
    max-tokens: 512
    overlap-tokens: 50
    min-tokens: 100
    heading-path-separator: " > "

  # Embedding Configuration
  embedding:
    batch-size: 32
    enabled: true

  # RAG Configuration (Phase 4-E)
  # NOTE: All RAG settings (provider, model, Neo4j, hybrid) are now managed per-project in dm_project_rag_config table.
  # System-wide defaults are stored in dm_system_config table (embedding.default-provider, embedding.default-model, etc.).

  # Admin Initialization Configuration
  admin:
    enabled: ${DOCST_ADMIN_AUTO_INIT:false}
    email: ${DOCST_ADMIN_EMAIL:admin@docst.local}
    password: ${DOCST_ADMIN_PASSWORD:}
    display-name: ${DOCST_ADMIN_NAME:System Admin}

  # CORS Configuration
  cors:
    enabled: ${DOCST_CORS_ENABLED:true}
    allowed-origins: ${DOCST_CORS_ALLOWED_ORIGINS:http://localhost:3000,http://localhost:3001,http://localhost:3002}
    allowed-methods: ${DOCST_CORS_ALLOWED_METHODS:GET,POST,PUT,PATCH,DELETE,OPTIONS}
    allowed-headers: ${DOCST_CORS_ALLOWED_HEADERS:Authorization,Content-Type,Accept,X-Requested-With}
    allow-credentials: ${DOCST_CORS_ALLOW_CREDENTIALS:true}
    max-age: ${DOCST_CORS_MAX_AGE:3600}
    exposed-headers: ${DOCST_CORS_EXPOSED_HEADERS:Authorization}

  # Password Policy Configuration
  security:
    password-policy:
      min-length: 8
      max-length: 128
      min-strength: 3
      history-count: 5
      expiration-days: 0  # 0 = unlimited

logging:
  level:
    com.docst: INFO

# P6Spy Configuration
decorator:
  datasource:
    p6spy:
      enable-logging: false
      multiline: false
      logging: slf4j
